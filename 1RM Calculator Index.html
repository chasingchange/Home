<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chasing Change — 1 Rep Max Calculator</title>
    <meta
      name="description"
      content="Stop guessing and start training with intent. Estimate your one-rep max targets, compare your current numbers, and get actionable working weights instantly."
    />

    <!-- Tailwind via CDN (embed-friendly) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;600;700&family=Museo+Moderno:wght@500;700&family=Raleway:wght@500;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind theme + brand tokens -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cc: {
                text: "#071f35",
                bg: "#f5f5f7",
                outline: "#77d770",
                card: "#ffffff",
              },
            },
            fontFamily: {
              body: ["Muli", "Mulish", "system-ui", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "sans-serif"],
              heading: ["Raleway", "system-ui", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "sans-serif"],
              brand: ["Museo Moderno", "Raleway", "sans-serif"],
            },
            boxShadow: {
              soft: "0 10px 30px rgba(7,31,53,0.10)",
              outline: "0 0 0 1px rgba(119,215,112,0.55)",
              glow: "0 10px 50px rgba(119,215,112,0.25)",
            },
          },
        },
      };
    </script>

    <!-- Custom CSS helpers -->
    <style>
      html,
      body {
        height: 100%;
      }
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 6px 10px;
        background: rgba(7, 31, 53, 0.06);
        border: 1px solid rgba(7, 31, 53, 0.08);
        font-size: 12px;
        font-weight: 700;
        opacity: 0.95;
      }


      /* Print mode */
      @media print {
        header,
        .no-print {
          display: none !important;
        }
        body {
          background: #ffffff;
        }
        main {
          box-shadow: none !important;
          border: 1px solid rgba(7, 31, 53, 0.15);
        }
      }
    </style>
  </head>

  <body class="min-h-screen bg-cc-bg text-cc-text font-body">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8">
      <header class="no-print mb-4 sm:mb-5">
        <div class="rounded-3xl overflow-hidden ring-1 ring-black/5 shadow-soft bg-white">
          <div class="relative p-6 sm:p-8">
            <div class="absolute -top-24 -right-24 w-72 h-72 rounded-full bg-cc-outline/20 blur-3xl"></div>
            <div class="absolute -bottom-28 -left-28 w-80 h-80 rounded-full bg-cc-text/10 blur-3xl"></div>

            <div class="relative flex flex-col sm:flex-row sm:items-center justify-between gap-5">
              <div class="flex items-center gap-4">
                <div
                  class="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-white ring-1 ring-black/10 shadow-soft flex items-center justify-center"
                  aria-hidden="true"
                >
                  <span class="font-brand text-xl">CC</span>
                </div>
                <div class="flex flex-col">
                  <p class="text-xs sm:text-sm tracking-[0.28em] uppercase font-brand opacity-60">Chasing Change</p>
                  <h1 class="mt-1 text-2xl sm:text-3xl font-extrabold font-heading leading-tight">1 Rep Max Calculator</h1>
                  <p class="text-sm opacity-80 mt-1">Stop guessing. Pick a lift, see your target numbers, and train with a plan that moves the needle.</p>
                </div>
              </div>

              <div class="flex flex-wrap gap-2 items-center">
                <a
                  href="https://tally.so/r/w5JXKE"
                  target="_blank"
                  rel="noreferrer"
                  class="inline-flex items-center justify-center rounded-2xl px-4 py-3 text-sm font-extrabold bg-cc-outline text-cc-text hover:opacity-90 transition shadow-outline"
                >
                  Want this dialed in? Apply for coaching →
                </a>
                <button
                  id="resetBtn"
                  class="px-5 py-3 rounded-2xl bg-cc-text text-white shadow-soft font-extrabold hover:opacity-95 transition"
                >
                  Reset
                </button>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="rounded-3xl bg-cc-card shadow-soft ring-1 ring-black/5 overflow-hidden p-4 sm:p-6">
        <section class="grid lg:grid-cols-12 gap-4">
        <!-- Inputs -->
        <div class="lg:col-span-5 rounded-3xl bg-cc-card shadow-soft ring-1 ring-black/5 overflow-hidden">
          <div class="p-5 border-b border-black/5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="font-heading font-extrabold text-xl">Your stats</div>
                <p class="text-sm opacity-70 mt-1">
                  This generates “what you should be able to do” targets by tier, plus working weights.
                </p>
              </div>
            </div>
          </div>

          <div class="p-5 space-y-4">
            <div class="grid sm:grid-cols-2 gap-3">
              <label class="block">
                <span class="text-sm font-extrabold">Sex</span>
                <select
                  id="sex"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                >
                  <option value="male" selected>Male</option>
                  <option value="female">Female</option>
                </select>
              </label>

              <label class="block">
                <span class="text-sm font-extrabold">Age</span>
                <input
                  id="age"
                  type="number"
                  min="10"
                  max="90"
                  value="25"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                />
              </label>

              <label class="block">
                <span class="text-sm font-extrabold">Weight (lbs)</span>
                <input
                  id="weight"
                  type="number"
                  min="70"
                  max="500"
                  value="180"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                />
              </label>

              <label class="block">
                <span class="text-sm font-extrabold">Height</span>
                <div class="mt-1 grid grid-cols-2 gap-2">
                  <input
                    id="heightFt"
                    type="number"
                    min="3"
                    max="7"
                    value="5"
                    class="w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                    placeholder="ft"
                  />
                  <input
                    id="heightIn"
                    type="number"
                    min="0"
                    max="11"
                    value="10"
                    class="w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                    placeholder="in"
                  />
                </div>
              </label>
            </div>

            <div class="grid sm:grid-cols-2 gap-3">
              <label class="block">
                <span class="text-sm font-extrabold">Units</span>
                <select
                  id="units"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                >
                  <option value="lb" selected>lb</option>
                  <option value="kg">kg</option>
                </select>
              </label>

              <label class="block">
                <span class="text-sm font-extrabold">Barbell rounding</span>
                <select
                  id="roundTo"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                >
                  <option value="2.5" selected>2.5 lb / 1.0 kg</option>
                  <option value="5">5 lb / 2.5 kg</option>
                  <option value="1">1 lb / 0.5 kg</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <!-- Exercise + Results -->
        <div class="lg:col-span-7 rounded-3xl bg-cc-card shadow-soft ring-1 ring-black/5 overflow-hidden">
          <div class="p-5 border-b border-black/5">
            <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
              <div>
                <div class="font-heading font-extrabold text-xl">Pick a lift</div>
                <p class="text-sm opacity-70 mt-1">
                  Search an exercise, or use the categories. Then you’ll see tier targets + working weights.
                </p>
              </div>
            </div>
          </div>

          <div class="p-5 space-y-4">
            <div class="grid sm:grid-cols-3 gap-3">
              <label class="block sm:col-span-2">
                <span class="text-sm font-extrabold">Search exercise</span>
                <input
                  id="search"
                  type="text"
                  placeholder="e.g., bench, squat, deadlift, pull-up, overhead press..."
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                />
              </label>

              <label class="block">
                <span class="text-sm font-extrabold">Category</span>
                <select
                  id="category"
                  class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                ></select>
              </label>
            </div>

            <label class="block">
              <span class="text-sm font-extrabold">Exercise</span>
              <select
                id="exercise"
                class="mt-1 w-full rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
              ></select>
            </label>

            <!-- Optional: compute true 1RM from a set -->
            <div class="rounded-3xl bg-cc-bg/50 border border-black/10 p-4">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                  <div class="font-extrabold">Have a recent set?</div>
                  <div class="text-sm opacity-75">
                    Enter your weight + reps to estimate your current 1RM (Epley / Brzycki average) and compare.
                  </div>
                </div>
              </div>

              <div class="mt-3 grid sm:grid-cols-3 gap-3">
                <label class="block">
                  <span class="text-sm font-extrabold">Set weight</span>
                  <input
                    id="setWeight"
                    type="number"
                    min="0"
                    step="1"
                    placeholder="e.g., 185"
                    class="mt-1 w-full rounded-2xl bg-cc-card border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                  />
                </label>
                <label class="block">
                  <span class="text-sm font-extrabold">Reps</span>
                  <input
                    id="setReps"
                    type="number"
                    min="1"
                    max="20"
                    step="1"
                    placeholder="e.g., 5"
                    class="mt-1 w-full rounded-2xl bg-cc-card border border-black/10 px-3 py-3 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                  />
                </label>
                <button
                  id="calcSetBtn"
                  class="mt-6 sm:mt-0 rounded-2xl bg-cc-card shadow-soft ring-1 ring-black/5 px-4 py-3 font-extrabold hover:shadow-glow transition"
                >
                  Calculate 1RM
                </button>
              </div>
            </div>

            <div class="rounded-2xl bg-cc-bg/60 border border-black/10 p-4">
              <div class="flex flex-wrap items-center gap-2">
                <span id="bmiBadge" class="badge">BMI: —</span>
                <span id="sexFactorBadge" class="badge">Sex factor: —</span>
                <span id="current1rmBadge" class="badge bg-cc-outline/25 border-cc-outline/50 text-cc-text font-extrabold">Current 1RM: —</span>
              </div>
            </div>

            <!-- Tiers -->
            <div class="rounded-3xl bg-cc-card shadow-outline ring-1 ring-black/5 overflow-hidden">
              <div class="p-4 border-b border-black/5 flex flex-wrap items-center justify-between gap-2">
                <div>
                  <div class="font-heading font-extrabold">Tier targets</div>
                </div>
                <span id="exerciseMeta" class="badge">—</span>
              </div>

              <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="text-left">
                    <tr class="border-b border-black/10">
                      <th class="py-2 pr-4 font-extrabold">Tier</th>
                      <th class="py-2 pr-4 font-extrabold">1RM target</th>
                      <th class="py-2 pr-4 font-extrabold">% BW (approx)</th>
                      <th class="py-2 pr-4 font-extrabold">Status vs current</th>
                    </tr>
                  </thead>
                  <tbody id="tiersBody"></tbody>
                </table>
              </div>
            </div>

            <!-- Working weights -->
            <div class="rounded-3xl bg-cc-card shadow-soft ring-1 ring-black/5 overflow-hidden">
              <div class="p-4 border-b border-black/5 flex items-center justify-between gap-2">
                <div>
                  <div class="font-heading font-extrabold">Working weights</div>
                  <div class="text-sm opacity-70">Based on the selected tier’s 1RM.</div>
                </div>
                <label class="flex items-center gap-2">
                  <span class="text-sm font-extrabold">Use tier</span>
                  <select
                    id="useTier"
                    class="rounded-2xl bg-cc-bg/60 border border-black/10 px-3 py-2 font-semibold outline-none focus:ring-2 focus:ring-cc-outline/60"
                  ></select>
                </label>
              </div>

              <div class="p-4 overflow-x-auto">
                <table class="w-full text-sm">
                  <thead class="text-left">
                    <tr class="border-b border-black/10">
                      <th class="py-2 pr-4 font-extrabold">Reps</th>
                      <th class="py-2 pr-4 font-extrabold">Intensity</th>
                      <th class="py-2 pr-4 font-extrabold">Suggested load</th>
                      <th class="py-2 pr-4 font-extrabold">Note</th>
                    </tr>
                  </thead>
                  <tbody id="workBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

        <footer class="mt-6 text-center text-sm opacity-60">
          © 2026 Chasing Change — 1% better every day
        </footer>

        <a
          href="https://tally.so/r/w5JXKE"
          target="_blank"
          rel="noreferrer"
          class="mt-5 inline-flex w-full items-center justify-center rounded-2xl px-4 py-4 text-sm font-extrabold bg-cc-text text-white hover:opacity-95 transition shadow-soft"
        >
          Want this dialed in? Apply for coaching →
        </a>
      </main>
    </div>

    <script>
      /***********************
       * Data model
       ***********************/
      const TIERS = [
        { key: "beginner", label: "Beginner", desc: "New lifter, building patterns + consistency." },
        { key: "novice", label: "Novice", desc: "Solid technique, training regularly." },
        { key: "intermediate", label: "Intermediate", desc: "Strong base, progressing with intent." },
        { key: "athlete", label: "Athlete", desc: "Highly capable, “gym-strong” and well-trained." },
      ];

      // Baseline tier multipliers are expressed as:
      // - type: "bw" => target1RM = bodyweight * multiplier
      // - type: "abs" => target1RM = absolute number (rare; mostly for carries)
      // - type: "rel" => relative to a base lift (squat/bench/dead/OHP) by factor
      //
      // For bodyweight moves, type: "bw" means added external load (e.g., weighted pull-up) uses BW multipliers
      // but also includes "bodyweightIncluded" to indicate how to interpret. We keep it simple:
      // - For pull-up/dip standards: report "TOTAL system load" = BW + added; and "Added load" as target too.
      const EXERCISES = [
        // Big barbell
        {
          id: "back_squat",
          name: "Back Squat (barbell)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 1.0, novice: 1.25, intermediate: 1.5, athlete: 1.75 },
          meta: "Full range, stable bracing, to depth.",
        },
        {
          id: "front_squat",
          name: "Front Squat (barbell)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 0.8, novice: 1.0, intermediate: 1.2, athlete: 1.4 },
          meta: "Typically ~80% of back squat for many lifters.",
        },
        {
          id: "deadlift",
          name: "Deadlift (conventional)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 1.25, novice: 1.5, intermediate: 1.75, athlete: 2.0 },
          meta: "Strong hinge + bracing. No bounce.",
        },
        {
          id: "sumo_deadlift",
          name: "Deadlift (sumo)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 1.2, novice: 1.45, intermediate: 1.7, athlete: 1.95 },
          meta: "Similar to conventional for many; varies by build.",
        },
        {
          id: "bench",
          name: "Bench Press (barbell)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 0.75, novice: 1.0, intermediate: 1.15, athlete: 1.3 },
          meta: "Paused touch recommended for consistency.",
        },
        {
          id: "ohp",
          name: "Overhead Press (barbell)",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 0.45, novice: 0.55, intermediate: 0.65, athlete: 0.75 },
          meta: "Strict press (no leg drive).",
        },
        {
          id: "power_clean",
          name: "Power Clean (barbell)",
          category: "Barbell — Athletic",
          type: "bw",
          multipliers: { beginner: 0.5, novice: 0.75, intermediate: 0.95, athlete: 1.15 },
          meta: "Athletic tier here is attainable, not Olympic-elite.",
        },
        {
          id: "hang_clean",
          name: "Hang Power Clean (barbell)",
          category: "Barbell — Athletic",
          type: "bw",
          multipliers: { beginner: 0.45, novice: 0.7, intermediate: 0.9, athlete: 1.1 },
          meta: "From hang; tends to be slightly lower than floor.",
        },
        {
          id: "push_press",
          name: "Push Press (barbell)",
          category: "Barbell — Athletic",
          type: "bw",
          multipliers: { beginner: 0.55, novice: 0.7, intermediate: 0.85, athlete: 1.0 },
          meta: "Leg drive allowed; lockout controlled.",
        },

        // Variations
        {
          id: "rdl",
          name: "Romanian Deadlift (barbell)",
          category: "Barbell — Variations",
          type: "bw",
          multipliers: { beginner: 0.9, novice: 1.1, intermediate: 1.3, athlete: 1.5 },
          meta: "Controlled eccentric; no floor touch needed.",
        },
        {
          id: "incline_bench",
          name: "Incline Bench Press (barbell)",
          category: "Barbell — Variations",
          type: "bw",
          multipliers: { beginner: 0.6, novice: 0.8, intermediate: 0.95, athlete: 1.1 },
          meta: "Lower than flat bench for most lifters.",
        },
        {
          id: "pause_bench",
          name: "Paused Bench Press (barbell)",
          category: "Barbell — Variations",
          type: "bw",
          multipliers: { beginner: 0.7, novice: 0.95, intermediate: 1.1, athlete: 1.25 },
          meta: "Stricter standard; removes bounce.",
        },
        {
          id: "hip_thrust",
          name: "Hip Thrust (barbell)",
          category: "Barbell — Variations",
          type: "bw",
          multipliers: { beginner: 1.25, novice: 1.75, intermediate: 2.25, athlete: 2.75 },
          meta: "Big numbers are common here. Control matters.",
        },

        // Dumbbells
        {
          id: "db_bench",
          name: "Dumbbell Bench Press (each hand)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.25, novice: 0.32, intermediate: 0.4, athlete: 0.48 },
          meta: "Target shown is per dumbbell (each hand).",
          perSide: true,
        },
        {
          id: "db_shoulder_press",
          name: "Dumbbell Shoulder Press (each hand)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.18, novice: 0.22, intermediate: 0.27, athlete: 0.32 },
          meta: "Target shown is per dumbbell (each hand).",
          perSide: true,
        },
        {
          id: "db_row",
          name: "One-Arm Dumbbell Row (one side)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.35, novice: 0.45, intermediate: 0.55, athlete: 0.65 },
          meta: "Target shown per hand (one side).",
          perSide: true,
        },
        {
          id: "db_rdl",
          name: "Dumbbell RDL (total load)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.65, novice: 0.85, intermediate: 1.05, athlete: 1.25 },
          meta: "Total load (both dumbbells combined).",
        },

        // Machines (more stable = higher multipliers)
        {
          id: "leg_press",
          name: "Leg Press (machine)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 2.0, novice: 2.75, intermediate: 3.5, athlete: 4.25 },
          meta: "Machine standards vary widely. Treat as a rough benchmark.",
        },
        {
          id: "hack_squat",
          name: "Hack Squat (machine)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 1.5, novice: 2.0, intermediate: 2.5, athlete: 3.0 },
          meta: "Controlled depth; don’t ego-lift.",
        },
        {
          id: "chest_press_machine",
          name: "Chest Press (machine)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.85, novice: 1.1, intermediate: 1.3, athlete: 1.5 },
          meta: "Stability makes machine presses higher than barbell bench for many.",
        },
        {
          id: "lat_pulldown",
          name: "Lat Pulldown (stack weight)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.7, novice: 0.9, intermediate: 1.05, athlete: 1.25 },
          meta: "Use strict form, full stretch, no lean-back heave.",
        },

        // Calisthenics / weighted bodyweight
        {
          id: "pullup_weighted",
          name: "Pull-Up (weighted) — added load",
          category: "Bodyweight + Weighted",
          type: "bw",
          multipliers: { beginner: 0.0, novice: 0.1, intermediate: 0.2, athlete: 0.35 },
          meta: "We show added load targets (not counting bodyweight).",
          bodyweightMove: true,
          showsAddedLoad: true,
        },
        {
          id: "dip_weighted",
          name: "Dip (weighted) — added load",
          category: "Bodyweight + Weighted",
          type: "bw",
          multipliers: { beginner: 0.0, novice: 0.15, intermediate: 0.3, athlete: 0.5 },
          meta: "Added load targets (not counting bodyweight). Shoulder-friendly depth.",
          bodyweightMove: true,
          showsAddedLoad: true,
        },
        {
          id: "chinup_weighted",
          name: "Chin-Up (weighted) — added load",
          category: "Bodyweight + Weighted",
          type: "bw",
          multipliers: { beginner: 0.0, novice: 0.12, intermediate: 0.25, athlete: 0.4 },
          meta: "Added load targets (not counting bodyweight).",
          bodyweightMove: true,
          showsAddedLoad: true,
        },

        // Carries (simple absolute-ish as BW based)
        {
          id: "farmers_carry",
          name: "Farmer’s Carry (each hand) — 10–20m",
          category: "Carries + Athletic",
          type: "bw",
          multipliers: { beginner: 0.25, novice: 0.33, intermediate: 0.42, athlete: 0.5 },
          meta: "Target shown per hand for a strong 10–20m carry.",
          perSide: true,
        },

        // “Every workout you can think of” (practical list)
        // We’ll add many common accessories with reasonable baselines.
        {
          id: "barbell_row",
          name: "Barbell Row (Pendlay-ish)",
          category: "Barbell — Pull",
          type: "bw",
          multipliers: { beginner: 0.65, novice: 0.85, intermediate: 1.0, athlete: 1.15 },
          meta: "Back parallel, controlled from floor (or near).",
        },
        {
          id: "trap_bar_deadlift",
          name: "Trap Bar Deadlift",
          category: "Barbell — Big Lifts",
          type: "bw",
          multipliers: { beginner: 1.35, novice: 1.65, intermediate: 1.9, athlete: 2.15 },
          meta: "Often higher than conventional due to leverage.",
        },
        {
          id: "split_squat",
          name: "Bulgarian Split Squat (total load)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.35, novice: 0.45, intermediate: 0.6, athlete: 0.75 },
          meta: "Total load (both dumbbells combined).",
        },
        {
          id: "leg_extension",
          name: "Leg Extension (stack weight)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.5, novice: 0.75, intermediate: 0.95, athlete: 1.15 },
          meta: "Machine variance is huge; use as tracking, not identity.",
        },
        {
          id: "hamstring_curl",
          name: "Hamstring Curl (stack weight)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.35, novice: 0.5, intermediate: 0.65, athlete: 0.8 },
          meta: "Strict reps; no hip pop.",
        },
        {
          id: "cable_row",
          name: "Seated Cable Row (stack weight)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.55, novice: 0.75, intermediate: 0.9, athlete: 1.05 },
          meta: "Full stretch + squeeze; don’t use momentum.",
        },
        {
          id: "cable_fly",
          name: "Cable Fly (per side)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.08, novice: 0.11, intermediate: 0.14, athlete: 0.18 },
          meta: "Per side (one handle). Focus on control.",
          perSide: true,
        },
        {
          id: "biceps_curl",
          name: "Dumbbell Curl (each hand)",
          category: "Dumbbell",
          type: "bw",
          multipliers: { beginner: 0.07, novice: 0.09, intermediate: 0.11, athlete: 0.14 },
          meta: "Per dumbbell (each hand). Strict curls.",
          perSide: true,
        },
        {
          id: "triceps_pushdown",
          name: "Triceps Pushdown (stack weight)",
          category: "Machines",
          type: "bw",
          multipliers: { beginner: 0.25, novice: 0.35, intermediate: 0.45, athlete: 0.6 },
          meta: "Elbows pinned; full lockout.",
        },
      ];

      /***********************
       * Helpers
       ***********************/
      const $ = (id) => document.getElementById(id);

      function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
      }

      function toKg(lb) {
        return lb * 0.45359237;
      }
      function toLb(kg) {
        return kg / 0.45359237;
      }

      function roundToIncrement(value, inc) {
        if (!isFinite(value)) return 0;
        return Math.round(value / inc) * inc;
      }

      function formatNumber(n, units, perSide = false) {
        const rounded = Math.round(n * 10) / 10;
        const suffix = units === "kg" ? "kg" : "lb";
        return perSide ? `${rounded} ${suffix} (each)` : `${rounded} ${suffix}`;
      }

      function bmi(weightLb, heightIn) {
        const w = weightLb;
        const h = heightIn;
        if (h <= 0) return null;
        return (w / (h * h)) * 703;
      }

      // Sex + age factors (practical, conservative)
      function getSexFactor(sex) {
        // You can tune this: 0.72–0.80 are common rough comparisons for upper-body;
        // we use 0.75 as a practical all-around default.
        return sex === "female" ? 0.75 : 1.0;
      }

      function getAgeFactor(age) {
        const a = clamp(Number(age) || 25, 10, 90);

        // Under 20: not fully “peaked”
        if (a < 20) {
          // 16 => ~0.85, 19 => ~0.97
          return clamp(0.7 + (a - 10) * 0.03, 0.75, 0.98);
        }

        // 20–35: peak-ish
        if (a <= 35) return 1.0;

        // After 35: gentle decline ~1% per year
        const decline = 1 - (a - 35) * 0.01;
        return clamp(decline, 0.6, 1.0);
      }

      function calcCurrent1RM(setWeight, reps) {
        const w = Number(setWeight);
        const r = Number(reps);
        if (!isFinite(w) || !isFinite(r) || w <= 0 || r < 1) return null;
        const repsClamped = clamp(r, 1, 20);

        // Epley: 1RM = w * (1 + r/30)
        const epley = w * (1 + repsClamped / 30);

        // Brzycki: 1RM = w * 36 / (37 - r)
        const denom = 37 - repsClamped;
        const brzycki = denom > 0 ? (w * 36) / denom : epley;

        return (epley + brzycki) / 2;
      }

      function statusText(target, current) {
        if (!current || !isFinite(current) || current <= 0) return "—";
        const diff = current - target;
        const pct = (diff / target) * 100;
        if (Math.abs(pct) < 2) return "≈ On target";
        if (pct > 0) return `Above by ${Math.round(pct)}%`;
        return `Below by ${Math.round(Math.abs(pct))}%`;
      }

      /***********************
       * Standards engine
       ***********************/
      function getExerciseById(id) {
        return EXERCISES.find((e) => e.id === id) || EXERCISES[0];
      }

      function getCategories() {
        const set = new Set(EXERCISES.map((e) => e.category));
        return ["All categories", ...Array.from(set).sort()];
      }

      function filterExercises(category, searchText) {
        const q = (searchText || "").trim().toLowerCase();
        return EXERCISES.filter((e) => {
          const inCat = category === "All categories" ? true : e.category === category;
          const inSearch = !q ? true : e.name.toLowerCase().includes(q);
          return inCat && inSearch;
        }).sort((a, b) => a.name.localeCompare(b.name));
      }

      function computeTierTargets({ exercise, weightLb, age, sex }) {
        const sexFactor = getSexFactor(sex);
        const ageFactor = getAgeFactor(age);

        // Base is bodyweight-based for most movements
        const base = weightLb;

        const targetsLb = {};
        for (const t of TIERS) {
          const mult = exercise.multipliers[t.key];
          let target = base * mult * sexFactor * ageFactor;

          // For bodyweight moves where multipliers represent "added load":
          // It's already base*mult; meaning added load scales with BW.
          // We'll show added load and (optionally) total system load.
          targetsLb[t.key] = target;
        }

        return { targetsLb, sexFactor, ageFactor };
      }

      /***********************
       * Working weights
       ***********************/
      // Approx rep->intensity map (simple and useful)
      const WORK_SETS = [
        { reps: "1–3", pct: 0.88, note: "Heavy skill + neural strength (avoid daily maxing)." },
        { reps: "4–6", pct: 0.80, note: "Best strength-and-size range for most lifters." },
        { reps: "6–8", pct: 0.75, note: "Hypertrophy focus with meaningful loading." },
        { reps: "8–10", pct: 0.70, note: "High-quality volume for growth." },
        { reps: "10–12", pct: 0.65, note: "Technique-first pump work." },
        { reps: "12–15", pct: 0.60, note: "Accessory work and joint-friendly volume." },
      ];

      function renderWorkingWeights(oneRmLb, units, roundChoice) {
        const incLb = Number(roundChoice) === 1 ? 1 : Number(roundChoice);
        const incKg = Number(roundChoice) === 1 ? 0.5 : Number(roundChoice) === 5 ? 2.5 : 1.0;

        const tbody = $("workBody");
        tbody.innerHTML = "";

        WORK_SETS.forEach((row) => {
          let loadLb = oneRmLb * row.pct;

          // round for practical loading
          if (units === "lb") loadLb = roundToIncrement(loadLb, incLb);
          else loadLb = toLb(roundToIncrement(toKg(loadLb), incKg));

          const shown = units === "lb" ? loadLb : toKg(loadLb);

          const tr = document.createElement("tr");
          tr.className = "border-b border-black/5";
          tr.innerHTML = `
            <td class="py-2 pr-4 font-extrabold">${row.reps}</td>
            <td class="py-2 pr-4">${Math.round(row.pct * 100)}%</td>
            <td class="py-2 pr-4 font-extrabold">${formatNumber(shown, units, false)}</td>
            <td class="py-2 pr-4 opacity-75">${row.note}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      /***********************
       * UI render
       ***********************/
      function populateCategorySelect() {
        const cats = getCategories();
        const sel = $("category");
        sel.innerHTML = "";
        cats.forEach((c) => {
          const opt = document.createElement("option");
          opt.value = c;
          opt.textContent = c;
          sel.appendChild(opt);
        });
      }

      function populateExerciseSelect(list, selectedId) {
        const sel = $("exercise");
        sel.innerHTML = "";
        list.forEach((e) => {
          const opt = document.createElement("option");
          opt.value = e.id;
          opt.textContent = e.name;
          sel.appendChild(opt);
        });

        // keep selected if possible
        const exists = list.some((e) => e.id === selectedId);
        sel.value = exists ? selectedId : (list[0] ? list[0].id : "");
      }

      function populateUseTierSelect() {
        const sel = $("useTier");
        sel.innerHTML = "";
        TIERS.forEach((t) => {
          const opt = document.createElement("option");
          opt.value = t.key;
          opt.textContent = t.label;
          sel.appendChild(opt);
        });
        sel.value = "novice";
      }

      function renderAll() {
        const sex = $("sex").value;
        const age = clamp(Number($("age").value) || 25, 10, 90);
        const units = $("units").value;
        const roundChoice = $("roundTo").value;

        const weightInput = Number($("weight").value) || 0;
        const weightLb = units === "lb" ? weightInput : toLb(weightInput);

        const ft = clamp(Number($("heightFt").value) || 0, 3, 7);
        const inch = clamp(Number($("heightIn").value) || 0, 0, 11);
        const heightInTotal = ft * 12 + inch;

        // BMI badge
        const b = bmi(weightLb, heightInTotal);
        $("bmiBadge").textContent = b ? `BMI: ${Math.round(b * 10) / 10}` : "BMI: —";

        // Factors
        const sexFactor = getSexFactor(sex);
        $("sexFactorBadge").textContent = `Sex factor: ${Math.round(sexFactor * 100)}%`;

        // Exercise list filter
        const category = $("category").value;
        const search = $("search").value;
        const list = filterExercises(category, search);

        // Ensure exercise select has options
        const currentSelected = $("exercise").value || (list[0] ? list[0].id : EXERCISES[0].id);
        populateExerciseSelect(list.length ? list : EXERCISES, currentSelected);

        const exercise = getExerciseById($("exercise").value);

        // Compute targets in lb, then convert for display
        const { targetsLb } = computeTierTargets({ exercise, weightLb, age, sex });

        // Current 1RM (if computed)
        const current1rmLb = window.__current1rmLb || null;

        // Exercise meta
        const metaBits = [];
        metaBits.push(exercise.category);
        if (exercise.perSide) metaBits.push("per side");
        if (exercise.bodyweightMove) metaBits.push("weighted BW");
        $("exerciseMeta").textContent = metaBits.join(" • ") || "—";

        // Render tier table
        const tiersBody = $("tiersBody");
        tiersBody.innerHTML = "";

        TIERS.forEach((t) => {
          let targetLb = targetsLb[t.key];

          // rounding
          const incLb = Number(roundChoice) === 1 ? 1 : Number(roundChoice);
          const incKg = Number(roundChoice) === 1 ? 0.5 : Number(roundChoice) === 5 ? 2.5 : 1.0;

          if (units === "lb") targetLb = roundToIncrement(targetLb, incLb);
          else targetLb = toLb(roundToIncrement(toKg(targetLb), incKg));

          const shownTarget = units === "lb" ? targetLb : toKg(targetLb);

          // If pullup/dip/chin: show "added load" and "total system load"
          let targetLabel = formatNumber(shownTarget, units, exercise.perSide);
          let bwPct = (targetsLb[t.key] / weightLb) * 100; // based on added load vs BW baseline
          bwPct = isFinite(bwPct) ? Math.round(bwPct) : 0;

          if (exercise.showsAddedLoad) {
            const totalSystemLb = weightLb + targetLb;
            const totalShown = units === "lb" ? totalSystemLb : toKg(totalSystemLb);
            targetLabel = `${formatNumber(shownTarget, units, false)} added • ${formatNumber(totalShown, units, false)} total`;
          }

          const tr = document.createElement("tr");
          tr.className = "border-b border-black/5";
          tr.innerHTML = `
            <td class="py-2 pr-4">
              <div class="font-extrabold">${t.label}</div>
              <div class="text-xs opacity-60 mt-0.5">${t.desc}</div>
            </td>
            <td class="py-2 pr-4 font-extrabold">${targetLabel}</td>
            <td class="py-2 pr-4">${exercise.showsAddedLoad ? `${bwPct}% BW (added)` : `${bwPct}% BW`}</td>
            <td class="py-2 pr-4">${statusText(targetLb, current1rmLb)}</td>
          `;
          tiersBody.appendChild(tr);
        });

        // Working weights from selected tier
        const useTier = $("useTier").value;
        let baseOneRmLb = targetsLb[useTier];

        // If bodyweight move with added load: "1RM" here is "added load 1RM"
        // Working weights still apply to that added load.
        renderWorkingWeights(baseOneRmLb, units, roundChoice);
      }

      /***********************
       * Events
       ***********************/
      function attachEvents() {
        ["sex", "age", "weight", "heightFt", "heightIn", "units", "roundTo", "category", "exercise", "useTier", "search"].forEach(
          (id) => {
            $(id).addEventListener("input", () => {
              // If units change, keep weight number but interpret as new unit (simple UX)
              // You can improve by converting on toggle, but this keeps things predictable.
              renderAll();
            });
          }
        );

        $("calcSetBtn").addEventListener("click", () => {
          const units = $("units").value;
          const w = Number($("setWeight").value);
          const r = Number($("setReps").value);

          if (!isFinite(w) || !isFinite(r) || w <= 0 || r < 1) {
            window.__current1rmLb = null;
            $("current1rmBadge").textContent = "Current 1RM: —";
            renderAll();
            return;
          }

          const setWeightLb = units === "lb" ? w : toLb(w);
          const estLb = calcCurrent1RM(setWeightLb, r);
          window.__current1rmLb = estLb;

          const shown = units === "lb" ? estLb : toKg(estLb);
          $("current1rmBadge").textContent = `Current 1RM: ${formatNumber(shown, units, false)}`;
          renderAll();
        });

        $("resetBtn").addEventListener("click", () => {
          $("sex").value = "male";
          $("age").value = 25;
          $("weight").value = 180;
          $("heightFt").value = 5;
          $("heightIn").value = 10;
          $("units").value = "lb";
          $("roundTo").value = "2.5";
          $("search").value = "";
          $("category").value = "All categories";
          window.__current1rmLb = null;
          $("setWeight").value = "";
          $("setReps").value = "";
          $("current1rmBadge").textContent = "Current 1RM: —";
          populateExerciseSelect(filterExercises("All categories", ""), "back_squat");
          $("useTier").value = "novice";
          renderAll();
        });

        // Keyboard: Enter to calc set
        ["setWeight", "setReps"].forEach((id) => {
          $(id).addEventListener("keydown", (e) => {
            if (e.key === "Enter") $("calcSetBtn").click();
          });
        });
      }

      /***********************
       * Init
       ***********************/
      function init() {
        populateCategorySelect();
        populateUseTierSelect();
        $("category").value = "All categories";
        populateExerciseSelect(filterExercises("All categories", ""), "back_squat");
        attachEvents();
        renderAll();
      }

      init();
    </script>
  </body>
</html>
